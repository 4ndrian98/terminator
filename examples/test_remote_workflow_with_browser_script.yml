---
tool_name: execute_sequence
arguments:
  variables:
    test_url:
      type: string
      label: "URL to test browser script on"
      default: "https://example.com"

    script_to_run:
      type: string
      label: "JavaScript to execute in browser"
      default: "document.title"

  inputs:
    test_url: "https://httpbin.org/html"
    script_to_run: |
      // Enhanced script that demonstrates DOM extraction capabilities
      const pageInfo = {
        title: document.title,
        url: window.location.href,
        timestamp: new Date().toISOString()
      };

      // Get HTML DOM with size management
      const html = document.documentElement.outerHTML;
      const maxLength = 10000; // Limit for this test
      
      // Extract page structure
      const domInfo = {
        ...pageInfo,
        htmlSnippet: html.substring(0, maxLength),
        htmlTotalLength: html.length,
        
        // Extract specific elements
        headings: Array.from(document.querySelectorAll('h1,h2,h3')).map(h => ({
          level: h.tagName,
          text: h.innerText
        })),
        
        // Count various elements
        elementCounts: {
          total: document.querySelectorAll('*').length,
          links: document.links.length,
          images: document.images.length,
          forms: document.forms.length
        },
        
        // Get meta information
        meta: {
          description: document.querySelector('meta[name="description"]')?.content || null,
          charset: document.characterSet,
          language: document.documentElement.lang || null
        }
      };

      // Create a test div to show we can modify the page
      const testDiv = document.createElement('div');
      testDiv.id = 'terminator-test-element';
      testDiv.style.cssText = 'position:fixed;top:10px;right:10px;background:green;color:white;padding:15px;z-index:9999;border-radius:5px;';
      testDiv.innerHTML = `
        <strong>Terminator DOM Test</strong><br>
        Title: ${pageInfo.title}<br>
        Elements: ${domInfo.elementCounts.total}<br>
        HTML Size: ${domInfo.htmlTotalLength} bytes
      `;
      document.body.appendChild(testDiv);

      return JSON.stringify(domInfo, null, 2);

  steps:
    # Step 1: Install Chrome extension using remote workflow
    - tool_name: execute_sequence
      arguments:
        url: "https://raw.githubusercontent.com/mediar-ai/terminator/main/terminator/browser-extension/install_chrome_extension_ui.yml"
        inputs:
          release_url: "https://github.com/mediar-ai/terminator/releases/latest/download/terminator-browser-extension.zip"
      continue_on_error: false
      delay_ms: 2000

    # Step 2: Open browser to test page
    - tool_name: navigate_browser
      arguments:
        url: "${{inputs.test_url}}"
        browser: "chrome"
      delay_ms: 3000

    # Step 3: Execute browser script using the installed extension
    - tool_name: execute_browser_script
      arguments:
        selector: "role:Document"
        script: "${{inputs.script_to_run}}"
      delay_ms: 1000

    # Step 4: Verify the test element was created
    - tool_name: validate_element
      arguments:
        selector: "#terminator-test-element"
        timeout_ms: 5000
      continue_on_error: true

    # Step 5: Take a screenshot to show the result
    - tool_name: capture_element_screenshot
      arguments:
        selector: "role:Document"
      continue_on_error: true

  stop_on_error: true
