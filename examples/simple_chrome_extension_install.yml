variables: {}
selectors: {}
steps:
  # Step 1: Download Chrome extension
  - tool_name: run_command
    arguments:
      engine: javascript
      script: |
        const fs = require('fs');
        const path = require('path');
        const os = require('os');
        (async () => {
          const url = 'https://github.com/mediar-ai/terminator/releases/latest/download/terminator-browser-extension.zip';
          const tmp = process.env.TEMP || os.tmpdir();
          const zipPath = path.join(tmp, 'terminator-browser-extension.zip');
          const destDir = path.join(tmp, 'terminator-bridge');
          
          try { fs.rmSync(destDir, { recursive: true, force: true }); } catch (_) {}
          try { fs.mkdirSync(destDir, { recursive: true }); } catch (e) { throw new Error('Failed to create dest dir: ' + e.message); }
          
          const res = await fetch(url);
          if (!res.ok) throw new Error(`Download failed: ${res.status} ${res.statusText}`);
          const arrayBuf = await res.arrayBuffer();
          fs.writeFileSync(zipPath, Buffer.from(arrayBuf));
          
          console.log(`Downloaded extension to: ${zipPath}`);
          return { zip_path: zipPath, extension_dir: destDir, success: true };
        })();
    delay_ms: 3000

  # Step 2: Extract extension
  - tool_name: run_command
    arguments:
      run: |
        $ErrorActionPreference = 'Stop'
        $zip = Join-Path $env:TEMP 'terminator-browser-extension.zip'
        $dest = Join-Path $env:TEMP 'terminator-bridge'
        if (Test-Path $dest) { Remove-Item -Recurse -Force $dest }
        New-Item -ItemType Directory -Force -Path $dest | Out-Null
        Expand-Archive -Path $zip -DestinationPath $dest -Force
        Write-Host "Extension extracted successfully"
      shell: powershell
    delay_ms: 2000

  # Step 3: Navigate to extensions page
  - tool_name: navigate_browser
    arguments:
      url: "chrome://extensions"
      browser: "chrome"
    delay_ms: 3000

  # Step 4: Install extension
  - tool_name: click_element
    arguments:
      selector: "role:Button|name:Load unpacked"
    timeout_ms: 10000
    continue_on_error: true
    delay_ms: 2000

  # Step 5: Select extension folder
  - tool_name: type_into_element
    arguments:
      selector: "role:Edit|name:Folder:"
      text_to_type: "C:\\Users\\louis\\AppData\\Local\\Temp\\terminator-bridge"
      clear_before_typing: true
    timeout_ms: 10000
    continue_on_error: true
    delay_ms: 1000

  # Step 6: Confirm selection
  - tool_name: click_element
    arguments:
      selector: "role:Button|name:Select Folder"
    timeout_ms: 10000
    continue_on_error: true
    delay_ms: 3000
