steps:
  - tool_name: run_javascript
    arguments:
      script: |
        const fs = require('fs');
        const path = require('path');
        const os = require('os');

        (async () => {
          const url = 'https://github.com/mediar-ai/terminator/releases/latest/download/terminator-browser-extension.zip';
          const tmp = process.env.TEMP || os.tmpdir();
          const zipPath = path.join(tmp, 'terminator-browser-extension.zip');
          const destDir = path.join(tmp, 'terminator-bridge');
          
          // Clean up and create directory
          try { fs.rmSync(destDir, { recursive: true, force: true }); } catch (_) {}
          try { fs.mkdirSync(destDir, { recursive: true }); } catch (e) { throw new Error('Failed to create dest dir: ' + e.message); }
          
          // Download and extract extension
          const res = await fetch(url);
          if (!res.ok) throw new Error(`Download failed: ${res.status} ${res.statusText}`);
          const arrayBuf = await res.arrayBuffer();
          fs.writeFileSync(zipPath, Buffer.from(arrayBuf));
          
          console.log(`Downloaded extension to: ${zipPath}`);
          return { zip_path: zipPath, extension_dir: destDir, success: true };
        })();
    delay_ms: 2000

  - tool_name: run_command
    arguments:
      run: "7z x -y \"$TEMP\\terminator-browser-extension.zip\" -o\"$TEMP\\terminator-bridge\""
      shell: bash
    delay_ms: 2000

  - tool_name: navigate_browser
    arguments:
      url: "chrome://extensions/"
      browser: "chrome"
    delay_ms: 3000

  - tool_name: type_into_element
    arguments:
      selector: "role:Edit|name:Address and search bar"
      text_to_type: "chrome://extensions/"
      clear_before_typing: true
    delay_ms: 1000

  - tool_name: press_key
    arguments:
      selector: "role:Edit|name:Address and search bar"
      key: "{Enter}"
    delay_ms: 3000

  - tool_name: click_element
    arguments:
      selector: "role:Button|name:Load unpacked"
    delay_ms: 2000

  - tool_name: type_into_element
    arguments:
      selector: "role:Edit|name:Folder:"
      text_to_type: "C:\\Users\\louis\\AppData\\Local\\Temp\\terminator-bridge"
      clear_before_typing: true
    delay_ms: 1000

  - tool_name: click_element
    arguments:
      selector: "role:Button|name:Select Folder"
    delay_ms: 3000

  - tool_name: navigate_browser
    arguments:
      url: "https://httpbin.org/html"
      browser: "chrome"
    delay_ms: 3000

  - tool_name: execute_browser_script
    arguments:
      selector: "role:Document"
      script: |
        (function() {
          const pageInfo = {
            title: document.title,
            url: document.location.href,
            totalElements: document.querySelectorAll('*').length,
            bodyText: document.body.innerText.substring(0, 200) + '...'
          };
          console.log('Page Info:', pageInfo);
          return pageInfo;
        })();
